# BTC Crash Prediction ML Pipeline

–ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è —Ä—ã–Ω–æ—á–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π, –ø—Ä–µ–¥—à–µ—Å—Ç–≤—É—é—â–∏—Ö –ª–∏–∫–≤–∏–¥–∞—Ü–∏–æ–Ω–Ω—ã–º –ø—Ä–æ–ª–∏–≤–∞–º BTC.

## üéØ –¶–µ–ª—å

–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –º–æ–¥–µ–ª—å –±–∏–Ω–∞—Ä–Ω–æ–π –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç **—Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä—ã–Ω–∫–∞ —Å –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é crash'–∞** (–ø–∞–¥–µ–Ω–∏–µ ‚â•5% –≤ —Ç–µ—á–µ–Ω–∏–µ 12 —á–∞—Å–æ–≤).

**–í–∞–∂–Ω–æ:** –ú–æ–¥–µ–ª—å –Ω–µ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç —Ü–µ–Ω—É. –û–Ω–∞ –≤—ã—è–≤–ª—è–µ—Ç –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤, —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –ø–æ—Å–ª–µ–¥—É—é—â–∏–º–∏ –ø—Ä–æ–ª–∏–≤–∞–º–∏.

## üìä –î–∞–Ω–Ω—ã–µ

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ API)

| –ü—Ä–∏–∑–Ω–∞–∫ | –ò—Å—Ç–æ—á–Ω–∏–∫ | –ò—Å—Ç–æ—Ä–∏—è |
|---------|----------|---------|
| OHLCV, Volume | Binance Futures | 5+ –ª–µ—Ç |
| Taker Buy/Sell Volume | Binance Futures | 5+ –ª–µ—Ç |
| Funding Rate | Binance Futures | 3+ –≥–æ–¥–∞ |
| Open Interest | Binance Futures | ~30 –¥–Ω–µ–π |
| Fear & Greed Index | Alternative.me | —Å 2018 |
| Spot-Futures Basis | Binance Spot + Futures | 5+ –ª–µ—Ç |

### –ù–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (—Ç—Ä–µ–±—É—é—Ç –ø–ª–∞—Ç–Ω—ã–µ API)

- Orderbook depth (bid/ask top 20)
- Exchange BTC inflow/reserve (on-chain)
- Liquidation clusters

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd scripts
pip install -r requirements.txt
```

### 2. –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ Veles Tools

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∫–ª–∞–¥–∫—É "Crash Analysis" –≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∞–Ω–∞–ª–∏–∑
3. –ù–∞–∂–º–∏—Ç–µ "–≠–∫—Å–ø–æ—Ä—Ç –¥–ª—è ML"

–ò–ª–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ CSV –Ω–∞–ø—Ä—è–º—É—é –∏–∑ —Å–µ—Ä–≤–∏—Å–∞ (—Ñ—É–Ω–∫—Ü–∏—è `exportDatasetToCSV`).

### 3. –ó–∞–ø—É—Å–∫ ML –ø–∞–π–ø–ª–∞–π–Ω–∞

```bash
python crash_ml_pipeline.py --input crash_data.csv
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

```
--input, -i          –ü—É—Ç—å –∫ CSV —Ñ–∞–π–ª—É (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
--crash-threshold    –ü–æ—Ä–æ–≥ –ø–∞–¥–µ–Ω–∏—è —Ü–µ–Ω—ã (%). Default: 5.0
--crash-window       –û–∫–Ω–æ –ø–æ–∏—Å–∫–∞ crash (–±–∞—Ä–æ–≤). Default: 48 (12 —á–∞—Å–æ–≤)
--train-years        –õ–µ—Ç –¥–ª—è –æ–±—É—á–µ–Ω–∏—è. Default: 2
--output-dir, -o     –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤. Default: crash_analysis_results
```

## üìà –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –ø–∞–π–ø–ª–∞–π–Ω

### 1. Feature Engineering

```python
# Z-scores (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è)
oi_zscore_24h          # Open Interest –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ 24h
funding_zscore_24h     # Funding Rate –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ 24h
atr_zscore_72h         # ATR –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ 72h
volume_zscore_24h      # Volume –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ 24h
feargreed_zscore_7d    # Fear & Greed –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ 7d
basis_zscore_24h       # Spot-Futures Basis –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ 24h

# –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è
taker_delta_ratio      # Sell Volume / Buy Volume
taker_imbalance        # (Sell - Buy) / Total

# –ë–∏–Ω–∞—Ä–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
funding_extreme        # |Funding| > 0.1%
basis_negative         # Backwardation (futures < spot)
feargreed_extreme_*    # Fear ‚â§ 20 –∏–ª–∏ Greed ‚â• 80
volume_spike           # Volume Z-score > 2

# –¶–µ–Ω–æ–≤—ã–µ
price_change_pct_*h    # –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã –∑–∞ 1h/4h/24h
price_from_high_24h    # –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –º–∞–∫—Å–∏–º—É–º–∞
rsi_14                 # RSI —Å –ø–µ—Ä–∏–æ–¥–æ–º 14

# –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ
market_overheated      # –°—á—ë—Ç—á–∏–∫: extreme funding + extreme greed + RSI > 70
pressure_building      # –°—á—ë—Ç—á–∏–∫: high OI + volume spike + ATR expanding
bearish_divergence     # –¶–µ–Ω–∞ —Ä–∞—Å—Ç—ë—Ç, OI –ø–∞–¥–∞–µ—Ç
```

### 2. Target Variable

```python
crash_target = 1 if min(price[t+1:t+48]) / price[t] <= 0.95 else 0
```

### 3. Walk-Forward Validation

–ù–µ random split! –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ:
- Train: 2 –≥–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö
- Test: —Å–ª–µ–¥—É—é—â–∏–µ 6 –º–µ—Å—è—Ü–µ–≤
- –°–¥–≤–∏–≥–∞–µ–º –æ–∫–Ω–æ –∏ –ø–æ–≤—Ç–æ—Ä—è–µ–º

### 4. –ú–æ–¥–µ–ª–∏

- **Logistic Regression** ‚Äî baseline, –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º—ã–π
- **Random Forest** ‚Äî –ª–æ–≤–∏—Ç –Ω–µ–ª–∏–Ω–µ–π–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- **XGBoost** ‚Äî state-of-the-art –¥–ª—è —Ç–∞–±–ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **LightGBM** ‚Äî –±—ã—Å—Ç—Ä—ã–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π

–í—Å–µ –º–æ–¥–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `class_weight='balanced'` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∏—Å–±–∞–ª–∞–Ω—Å–æ–º –∫–ª–∞—Å—Å–æ–≤.

### 5. –ú–µ—Ç—Ä–∏–∫–∏

- **ROC AUC** ‚Äî –æ–±—â–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è
- **Precision** ‚Äî —Ç–æ—á–Ω–æ—Å—Ç—å –ø—Ä–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–∏ crash (–≤–∞–∂–Ω–µ–µ!)
- **Recall** ‚Äî –ø–æ–ª–Ω–æ—Ç–∞ (—Å–∫–æ–ª—å–∫–æ crash'–µ–π –ø–æ–π–º–∞–ª–∏)

### 6. –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è

- **Feature Importance** ‚Äî –∫–∞–∫–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –≤–∞–∂–Ω—ã –¥–ª—è –º–æ–¥–µ–ª–∏
- **SHAP values** ‚Äî –∫–∞–∫ –∫–∞–∂–¥—ã–π –ø—Ä–∏–∑–Ω–∞–∫ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ
- **–ü—Ä–∞–≤–∏–ª–∞** ‚Äî –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —É—Å–ª–æ–≤–∏—è —Å –≤—ã—Å–æ–∫–æ–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é crash

## üìã –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ü–∞–π–ø–ª–∞–π–Ω —Å–æ–∑–¥–∞—ë—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å:

```
crash_analysis_results/
‚îú‚îÄ‚îÄ roc_curves.png           # ROC –∫—Ä–∏–≤—ã–µ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π
‚îú‚îÄ‚îÄ precision_recall_curves.png
‚îú‚îÄ‚îÄ feature_importance.png   # –¢–æ–ø-20 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
‚îú‚îÄ‚îÄ shap_summary_*.png       # SHAP –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
‚îî‚îÄ‚îÄ crash_rules.txt          # –ü—Ä–∞–≤–∏–ª–∞ –≤—ã—Å–æ–∫–æ–≥–æ —Ä–∏—Å–∫–∞
```

### –ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª

```
#1. taker_delta_ratio > 1.2 –ò funding_zscore_24h > 1.5
    ‚Üí P(crash) = 18.3%
    ‚Üí Lift = 3.2x
    ‚Üí Support = 847 –ø—Ä–∏–º–µ—Ä–æ–≤

#2. feargreed_extreme_greed = 1 –ò oi_zscore_24h > 2.0
    ‚Üí P(crash) = 15.7%
    ‚Üí Lift = 2.8x
    ‚Üí Support = 512 –ø—Ä–∏–º–µ—Ä–æ–≤
```

## ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **Open Interest** ‚Äî —Ç–æ–ª—å–∫–æ ~30 –¥–Ω–µ–π –∏—Å—Ç–æ—Ä–∏–∏ —á–µ—Ä–µ–∑ –ø—É–±–ª–∏—á–Ω—ã–π API
2. **–î–∏—Å–±–∞–ª–∞–Ω—Å –∫–ª–∞—Å—Å–æ–≤** ‚Äî crash'–µ–π –º–∞–ª–æ (~2-5% –¥–∞–Ω–Ω—ã—Ö)
3. **–†–µ–∂–∏–º—ã —Ä—ã–Ω–∫–∞** ‚Äî –ø—Ä–∞–≤–∏–ª–∞ –º–æ–≥—É—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –Ω–æ–≤—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö
4. **–ó–∞–ø–∞–∑–¥—ã–≤–∞–Ω–∏–µ** ‚Äî –ø—Ä–∏–∑–Ω–∞–∫–∏ —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã, –Ω–µ –ø—Ä–æ–∞–∫—Ç–∏–≤–Ω—ã

## üî¨ –ò–¥–µ–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è

1. **–î–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ** (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø):
   - Liquidation heatmaps (Coinglass)
   - Exchange flows (Glassnode)
   - Options data (Deribit)

2. **–£–ª—É—á—à–∏—Ç—å –ø—Ä–∏–∑–Ω–∞–∫–∏**:
   - –°–∫–æ–ª—å–∑—è—â–∏–µ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ –º–µ–∂–¥—É –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏
   - –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
   - –ü–∞—Ç—Ç–µ—Ä–Ω—ã –æ–±—ä—ë–º–∞ (Volume Profile)

3. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã**:
   - Anomaly detection –≤–º–µ—Å—Ç–æ classification
   - Time-series models (LSTM, Transformer)
   - Ensemble —Å —Ä–∞–∑–Ω—ã–º–∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–º–∏

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞–∫ —Ö–æ—Ç–∏—Ç–µ, –Ω–æ –Ω–∞ —Å–≤–æ–π —Ä–∏—Å–∫!
