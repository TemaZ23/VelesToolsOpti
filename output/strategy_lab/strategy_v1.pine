// This Pine Scriptâ„¢ source code is subject to the terms of the Mozilla Public License 2.0
// https://mozilla.org/MPL/2.0/
// Â© Strategy Lab â€” Self-Improving Trading Strategy
// Generated by Strategy Lab Optimizer (Cross-Validated Walk-Forward)

//@version=6
strategy("Strategy Lab BTC 15m", 
     overlay=true, 
     default_qty_type=strategy.percent_of_equity, 
     default_qty_value=15.26,
     initial_capital=10000,
     currency=currency.USD,
     commission_type=strategy.commission.percent,
     commission_value=0.04,
     slippage=3,
     pyramiding=0,
     calc_on_every_tick=false,
     process_orders_on_close=false,
     max_bars_back=500)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INPUTS â€” Optimized Parameters
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Risk Management
i_leverage      = input.float(4.40,  "Leverage",            minval=1, maxval=20, step=0.1)
i_sl_pct        = input.float(4.50,  "Stop Loss %",         minval=0.5, maxval=20, step=0.1)
i_tp_pct        = input.float(14.27, "Take Profit %",       minval=1, maxval=50, step=0.1)
i_trail_pct     = input.float(0.026, "Trailing Stop %",     minval=0, maxval=5, step=0.001)
i_max_hold      = input.int(143,     "Max Hold Bars",       minval=0, maxval=500)
i_risk_per_trade= input.float(15.26, "Risk Per Trade %",    minval=1, maxval=50, step=0.1)

// Combine
i_threshold     = input.float(0.214, "Signal Threshold",    minval=0, maxval=1, step=0.001)

// Indicator 1: EMA Cross
i_ema_fast      = input.int(7,   "EMA Fast",    minval=2, maxval=50)
i_ema_slow      = input.int(91,  "EMA Slow",    minval=15, maxval=200)
i_ema_w         = input.float(0.299, "EMA Weight", minval=0, maxval=5, step=0.001)
i_ema_long_thr  = input.float(0.058, "EMA Long Thr",  minval=-1, maxval=1, step=0.001)
i_ema_short_thr = input.float(-0.502, "EMA Short Thr", minval=-1, maxval=1, step=0.001)

// Indicator 2: SuperTrend
i_st_period     = input.int(6,      "SuperTrend Period",   minval=2, maxval=50)
i_st_mult       = input.float(3.242, "SuperTrend Mult",    minval=0.5, maxval=10, step=0.001)
i_st_w          = input.float(1.590, "SuperTrend Weight",  minval=0, maxval=5, step=0.001)
i_st_long_thr   = input.float(0.226, "ST Long Thr",  minval=-1, maxval=1, step=0.001)
i_st_short_thr  = input.float(-0.486, "ST Short Thr", minval=-1, maxval=1, step=0.001)

// Indicator 3: ADX Direction
i_adx_period    = input.int(13,     "ADX Period",          minval=5, maxval=50)
i_adxd_w        = input.float(0.599, "ADX Dir Weight",     minval=0, maxval=5, step=0.001)
i_adxd_long_thr = input.float(0.549, "ADX Dir Long Thr",   minval=-1, maxval=1, step=0.001)
i_adxd_short_thr= input.float(0.048, "ADX Dir Short Thr",  minval=-1, maxval=1, step=0.001)

// Indicator 4: Triple EMA
i_tema_fast     = input.int(7,   "TEMA Fast",   minval=2, maxval=20)
i_tema_mid      = input.int(20,  "TEMA Mid",    minval=10, maxval=50)
i_tema_slow     = input.int(69,  "TEMA Slow",   minval=30, maxval=150)
i_tema_w        = input.float(2.265, "TEMA Weight", minval=0, maxval=5, step=0.001)
i_tema_long_thr = input.float(0.828, "TEMA Long Thr",  minval=-1, maxval=1, step=0.001)
i_tema_short_thr= input.float(0.337, "TEMA Short Thr", minval=-1, maxval=1, step=0.001)

// Indicator 5: Linear Regression Slope
i_lr_period     = input.int(44,     "LR Slope Period",     minval=5, maxval=200)
i_lr_w          = input.float(1.621, "LR Slope Weight",    minval=0, maxval=5, step=0.001)
i_lr_long_thr   = input.float(0.029, "LR Long Thr",  minval=-1, maxval=1, step=0.001)
i_lr_short_thr  = input.float(-0.723, "LR Short Thr", minval=-1, maxval=1, step=0.001)

// Indicator 6: RSI Signal
i_rsi_period    = input.int(26,  "RSI Period",      minval=5, maxval=50)
i_rsi_oversold  = input.int(17,  "RSI Oversold",    minval=5, maxval=40)
i_rsi_overbought= input.int(64,  "RSI Overbought",  minval=50, maxval=95)
i_rsi_w         = input.float(0.380, "RSI Weight",  minval=0, maxval=5, step=0.001)
i_rsi_long_thr  = input.float(0.674, "RSI Long Thr",  minval=-1, maxval=1, step=0.001)
i_rsi_short_thr = input.float(0.495, "RSI Short Thr", minval=-1, maxval=1, step=0.001)

// Indicator 7: MACD Cross
i_macd_fast     = input.int(15,  "MACD Fast",    minval=5, maxval=30)
i_macd_slow     = input.int(25,  "MACD Slow",    minval=15, maxval=50)
i_macd_signal   = input.int(6,   "MACD Signal",  minval=2, maxval=20)
i_macd_w        = input.float(2.483, "MACD Weight", minval=0, maxval=5, step=0.001)
i_macd_long_thr = input.float(0.908, "MACD Long Thr",  minval=-1, maxval=1, step=0.001)
i_macd_short_thr= input.float(-0.492, "MACD Short Thr", minval=-1, maxval=1, step=0.001)

// Time Filter
i_time_filter   = input.bool(true, "Time Filter Enabled")
i_hour_start    = input.int(3,   "Trade Hours Start (UTC)", minval=0, maxval=23)
i_hour_end      = input.int(21,  "Trade Hours End (UTC)",   minval=1, maxval=24)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPER FUNCTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Expanding window normalization to [-1, 1] (matches Python _normalize_to_unit)
// Uses persistent var to track all-time min/max â€” true expanding window
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var float _lr_exp_min = na
var float _lr_exp_max = na

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INDICATOR 1: EMA Cross â€” binary signal {-1, +1}
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ema_fast_val = ta.ema(close, i_ema_fast)
ema_slow_val = ta.ema(close, i_ema_slow)
ema_cross_val = ema_fast_val > ema_slow_val ? 1.0 : -1.0

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INDICATOR 2: SuperTrend â€” binary signal {-1, +1}
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[st_line, st_dir] = ta.supertrend(i_st_mult, i_st_period)
// ta.supertrend returns direction: -1 = uptrend, 1 = downtrend (inverted)
supertrend_val = st_dir < 0 ? 1.0 : -1.0

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INDICATOR 3: ADX Direction â€” binary signal {-1, +1}
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DI+ and DI- calculation
adx_up_move = ta.change(high)
adx_dn_move = -ta.change(low)
adx_plus_dm = adx_up_move > adx_dn_move and adx_up_move > 0 ? adx_up_move : 0.0
adx_minus_dm = adx_dn_move > adx_up_move and adx_dn_move > 0 ? adx_dn_move : 0.0

adx_atr = ta.atr(i_adx_period)
adx_plus_di  = 100 * ta.ema(adx_plus_dm, i_adx_period) / (adx_atr == 0 ? 1.0 : adx_atr)
adx_minus_di = 100 * ta.ema(adx_minus_dm, i_adx_period) / (adx_atr == 0 ? 1.0 : adx_atr)

adx_direction_val = adx_plus_di > adx_minus_di ? 1.0 : -1.0

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INDICATOR 4: Triple EMA â€” ternary signal {-1, 0, +1}
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
tema_f = ta.ema(close, i_tema_fast)
tema_m = ta.ema(close, i_tema_mid)
tema_s = ta.ema(close, i_tema_slow)

tema_bullish = tema_f > tema_m and tema_m > tema_s
tema_bearish = tema_f < tema_m and tema_m < tema_s
triple_ema_val = tema_bullish ? 1.0 : tema_bearish ? -1.0 : 0.0

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INDICATOR 5: Linear Regression Slope (normalized)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
lr_slope_raw = ta.linreg(close, i_lr_period, 0) - ta.linreg(close, i_lr_period, 1)
// Normalize slope relative to price
lr_slope_norm_raw = lr_slope_raw / close
// Expanding normalization (true all-time min/max like Python expanding window)
_lr_exp_min := na(_lr_exp_min) ? lr_slope_norm_raw : math.min(_lr_exp_min, lr_slope_norm_raw)
_lr_exp_max := na(_lr_exp_max) ? lr_slope_norm_raw : math.max(_lr_exp_max, lr_slope_norm_raw)
lr_rng = _lr_exp_max - _lr_exp_min
lr_mid = (_lr_exp_min + _lr_exp_max) / 2.0
lr_half = lr_rng / 2.0
lr_slope_val = lr_half != 0 ? math.max(-1.0, math.min(1.0, (lr_slope_norm_raw - lr_mid) / lr_half)) : 0.0

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INDICATOR 6: RSI Signal â€” ternary signal {-1, 0, +1}
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
rsi_raw = ta.rsi(close, i_rsi_period)
rsi_signal_val = rsi_raw < i_rsi_oversold ? 1.0 : rsi_raw > i_rsi_overbought ? -1.0 : 0.0

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INDICATOR 7: MACD Cross â€” binary signal {-1, +1}
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
macd_line = ta.ema(close, i_macd_fast) - ta.ema(close, i_macd_slow)
macd_sig_line = ta.ema(macd_line, i_macd_signal)
macd_cross_val = macd_line > macd_sig_line ? 1.0 : -1.0

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WEIGHTED SIGNAL COMBINATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// For each indicator: if value > long_threshold â†’ long signal (+1)
//                     if value < short_threshold â†’ short signal (-1)
//                     else â†’ neutral (0)
ema_sig   = ema_cross_val > i_ema_long_thr ? 1.0 : ema_cross_val < i_ema_short_thr ? -1.0 : 0.0
st_sig    = supertrend_val > i_st_long_thr ? 1.0 : supertrend_val < i_st_short_thr ? -1.0 : 0.0
adxd_sig  = adx_direction_val > i_adxd_long_thr ? 1.0 : adx_direction_val < i_adxd_short_thr ? -1.0 : 0.0
tema_sig  = triple_ema_val > i_tema_long_thr ? 1.0 : triple_ema_val < i_tema_short_thr ? -1.0 : 0.0
lr_sig    = lr_slope_val > i_lr_long_thr ? 1.0 : lr_slope_val < i_lr_short_thr ? -1.0 : 0.0
rsi_sig   = rsi_signal_val > i_rsi_long_thr ? 1.0 : rsi_signal_val < i_rsi_short_thr ? -1.0 : 0.0
macd_sig  = macd_cross_val > i_macd_long_thr ? 1.0 : macd_cross_val < i_macd_short_thr ? -1.0 : 0.0

// Weighted sum
weighted_sum = ema_sig * i_ema_w + st_sig * i_st_w + adxd_sig * i_adxd_w + 
               tema_sig * i_tema_w + lr_sig * i_lr_w + rsi_sig * i_rsi_w + 
               macd_sig * i_macd_w

total_weight = i_ema_w + i_st_w + i_adxd_w + i_tema_w + i_lr_w + i_rsi_w + i_macd_w
normalized_signal = total_weight > 0 ? weighted_sum / total_weight : 0.0

// Final signal
final_signal = normalized_signal > i_threshold ? 1 : normalized_signal < -i_threshold ? -1 : 0

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TIME FILTER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
utc_hour = hour(time, "UTC")
in_session = not i_time_filter or (utc_hour >= i_hour_start and utc_hour < i_hour_end)
filtered_signal = in_session ? final_signal : 0

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STRATEGY EXECUTION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Track entry bar for max hold
var int entry_bar_index = 0
var int current_signal = 0

// Detect signal change (1-bar delay is handled by process_orders_on_close=false)
signal_changed = filtered_signal != filtered_signal[1]

// Entry conditions (use signal from PREVIOUS bar for 1-bar delay)
prev_signal = filtered_signal[1]
long_entry  = prev_signal == 1 and strategy.position_size <= 0
short_entry = prev_signal == -1 and strategy.position_size >= 0

// Max hold exit
bars_since_entry = bar_index - entry_bar_index
max_hold_exit = i_max_hold > 0 and strategy.position_size != 0 and bars_since_entry >= i_max_hold

// Signal flip exit
signal_flip_long  = strategy.position_size > 0 and prev_signal == -1
signal_flip_short = strategy.position_size < 0 and prev_signal == 1

// â”€â”€ POSITION SIZING â”€â”€
// Position size = risk_per_trade % of equity Ã— leverage
// In TradingView, default_qty_value=15.26% already handles risk_per_trade
// Leverage effect: we trade i_leverage Ã— equity portion
qty_pct = i_risk_per_trade * i_leverage / 100.0

// â”€â”€ STOP LOSS / TAKE PROFIT (adjusted for leverage) â”€â”€
// SL/TP are in price % terms, same as in Python backtester
long_sl  = strategy.position_avg_price * (1 - i_sl_pct / 100)
long_tp  = strategy.position_avg_price * (1 + i_tp_pct / 100)
short_sl = strategy.position_avg_price * (1 + i_sl_pct / 100)
short_tp = strategy.position_avg_price * (1 - i_tp_pct / 100)

// â”€â”€ EXECUTE TRADES â”€â”€

// Close on signal flip or max hold
if signal_flip_long or signal_flip_short
    strategy.close_all(comment="Signal Flip")
    
if max_hold_exit  
    strategy.close_all(comment="Max Hold " + str.tostring(i_max_hold) + " bars")

// Long Entry
if long_entry and barstate.isconfirmed
    strategy.entry("Long", strategy.long, qty=strategy.equity * qty_pct / close, 
                   comment="Long Entry")
    entry_bar_index := bar_index

// Short Entry  
if short_entry and barstate.isconfirmed
    strategy.entry("Short", strategy.short, qty=strategy.equity * qty_pct / close,
                   comment="Short Entry")
    entry_bar_index := bar_index

// SL / TP for active positions
if strategy.position_size > 0
    strategy.exit("Long Exit", "Long", stop=long_sl, limit=long_tp,
                  trail_points=i_trail_pct > 0 ? close * i_trail_pct / 100 / syminfo.mintick : na,
                  trail_offset=i_trail_pct > 0 ? close * i_trail_pct / 100 / syminfo.mintick : na,
                  comment_loss="SL", comment_profit="TP")

if strategy.position_size < 0
    strategy.exit("Short Exit", "Short", stop=short_sl, limit=short_tp,
                  trail_points=i_trail_pct > 0 ? close * i_trail_pct / 100 / syminfo.mintick : na,
                  trail_offset=i_trail_pct > 0 ? close * i_trail_pct / 100 / syminfo.mintick : na,
                  comment_loss="SL", comment_profit="TP")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VISUAL: Signal Dashboard
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Background color for signal direction
bgcolor(filtered_signal == 1 ? color.new(color.green, 92) : 
        filtered_signal == -1 ? color.new(color.red, 92) : na)

// Plot SuperTrend line
plot(st_line, "SuperTrend", color=supertrend_val > 0 ? color.green : color.red, linewidth=2)

// Plot EMAs
plot(ema_fast_val, "EMA Fast", color=color.new(color.blue, 50), linewidth=1)
plot(ema_slow_val, "EMA Slow", color=color.new(color.orange, 50), linewidth=1)
plot(tema_f, "TEMA Fast", color=color.new(color.aqua, 70), linewidth=1)
plot(tema_m, "TEMA Mid",  color=color.new(color.yellow, 70), linewidth=1)
plot(tema_s, "TEMA Slow", color=color.new(color.purple, 70), linewidth=1)

// Entry markers
plotshape(long_entry and barstate.isconfirmed, "Long", shape.triangleup, 
          location.belowbar, color.green, size=size.small)
plotshape(short_entry and barstate.isconfirmed, "Short", shape.triangledown, 
          location.abovebar, color.red, size=size.small)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INFO TABLE â€” Live Dashboard
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var table dash = table.new(position.top_right, 2, 12, 
                           bgcolor=color.new(color.black, 80), 
                           border_color=color.gray, border_width=1)

if barstate.islast
    table.cell(dash, 0, 0, "Strategy Lab", text_color=color.white, text_size=size.normal)
    table.cell(dash, 1, 0, "BTC 15m", text_color=color.yellow, text_size=size.normal)
    
    table.cell(dash, 0, 1, "Signal", text_color=color.gray)
    table.cell(dash, 1, 1, filtered_signal == 1 ? "ğŸŸ¢ LONG" : filtered_signal == -1 ? "ğŸ”´ SHORT" : "âšª FLAT",
               text_color=filtered_signal == 1 ? color.green : filtered_signal == -1 ? color.red : color.gray)
    
    table.cell(dash, 0, 2, "Strength", text_color=color.gray)
    table.cell(dash, 1, 2, str.tostring(math.abs(normalized_signal), "#.###"), text_color=color.white)
    
    table.cell(dash, 0, 3, "EMA Cross", text_color=color.gray)
    table.cell(dash, 1, 3, str.tostring(ema_sig, "#.#"), text_color=ema_sig > 0 ? color.green : ema_sig < 0 ? color.red : color.gray)
    
    table.cell(dash, 0, 4, "SuperTrend", text_color=color.gray)
    table.cell(dash, 1, 4, str.tostring(st_sig, "#.#"), text_color=st_sig > 0 ? color.green : st_sig < 0 ? color.red : color.gray)
    
    table.cell(dash, 0, 5, "ADX Dir", text_color=color.gray)
    table.cell(dash, 1, 5, str.tostring(adxd_sig, "#.#"), text_color=adxd_sig > 0 ? color.green : adxd_sig < 0 ? color.red : color.gray)
    
    table.cell(dash, 0, 6, "Triple EMA", text_color=color.gray)
    table.cell(dash, 1, 6, str.tostring(tema_sig, "#.#"), text_color=tema_sig > 0 ? color.green : tema_sig < 0 ? color.red : color.gray)
    
    table.cell(dash, 0, 7, "LR Slope", text_color=color.gray)
    table.cell(dash, 1, 7, str.tostring(lr_sig, "#.#"), text_color=lr_sig > 0 ? color.green : lr_sig < 0 ? color.red : color.gray)
    
    table.cell(dash, 0, 8, "RSI", text_color=color.gray)
    table.cell(dash, 1, 8, str.tostring(rsi_sig, "#.#") + " (" + str.tostring(rsi_raw, "#.#") + ")", 
               text_color=rsi_sig > 0 ? color.green : rsi_sig < 0 ? color.red : color.gray)
    
    table.cell(dash, 0, 9, "MACD Cross", text_color=color.gray)
    table.cell(dash, 1, 9, str.tostring(macd_sig, "#.#"), text_color=macd_sig > 0 ? color.green : macd_sig < 0 ? color.red : color.gray)
    
    table.cell(dash, 0, 10, "Leverage", text_color=color.gray)
    table.cell(dash, 1, 10, str.tostring(i_leverage, "#.#") + "x", text_color=color.yellow)
    
    table.cell(dash, 0, 11, "Bars Held", text_color=color.gray)
    table.cell(dash, 1, 11, strategy.position_size != 0 ? str.tostring(bars_since_entry) + "/" + str.tostring(i_max_hold) : "â€”", text_color=color.white)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ALERTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
alertcondition(long_entry,  "Long Entry",  "Strategy Lab: LONG entry signal")
alertcondition(short_entry, "Short Entry", "Strategy Lab: SHORT entry signal")
alertcondition(max_hold_exit, "Max Hold Exit", "Strategy Lab: Max hold bars reached")
alertcondition(signal_flip_long or signal_flip_short, "Signal Flip", "Strategy Lab: Signal flip â€” close position")
